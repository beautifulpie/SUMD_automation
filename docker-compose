version: '3'

services:
  sumd-gpu:
    build:
      context: .
      dockerfile: Dockerfile
    image: gromacs-gpu
    volumes:
      - ./pdbs:/sumd/data
      - ./results:/sumd/results
    # GPU 지원 설정
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    
    # 기본 명령어 (이 명령어를 실행하거나 주석 처리하고 대화형 모드로 실행)
    command: >
      python3 Running_SuMD_Automation.py 
      --dataset_path /sumd/data 
      --save_path /sumd/results 
      --sumd_script_path /sumd/SuMD_script.py 
      --pdb_list_path /sumd/data/pdb_list.txt 
      --protein_chain A 
      --peptide_chain B
    
    # 리소스 제한 설정 - 필요에 따라 조정
    # 대화형 모드로 실행하려면 다음 줄의 주석을 해제하고 command 줄을 주석 처리
    # stdin_open: true
    # tty: true